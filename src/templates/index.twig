{% extends '_layouts/cp' %}
{% set title = settings.navLabel ?: 'Embed Iframe' %}

{% block main %}
  <style>
    .dci-iframe-wrap { width: 100%; height: 100vh; max-height: 100vh; overflow: hidden; }
    .dci-iframe-wrap iframe { width: 100%; height: 100%; border: 0; display: block; }
  </style>

  <div>
    {% if settings.embedUrl %}
      {% set sandboxTokens = ['allow-scripts','allow-forms','allow-popups'] %}
      {# If the site needs cookies/localStorage, enable same-origin #}
      {% if settings.sandboxSameOrigin %}
        {% set sandboxTokens = sandboxTokens|merge(['allow-same-origin']) %}
      {% endif %}
      
      {# Optional: Some apps need to open popups outside the sandbox #}
      {# {% set sandboxTokens = sandboxTokens|merge(['allow-popups-to-escape-sandbox']) %} #}

      <div class="dci-iframe-wrap">
        <iframe
          src="{{ settings.embedUrl | e('html_attr') }}"
          loading="lazy"
          referrerpolicy="no-referrer-when-downgrade"
          sandbox="{{ sandboxTokens|join(' ') }}">
        </iframe>
      </div>
    {% else %}
      <p class="warning">
        {{ 'No URL configured. Go to Settings → Plugins → Embed Iframe.' | t('_embed-iframe') }}
      </p>
    {% endif %}
  </div>
{% endblock %}
